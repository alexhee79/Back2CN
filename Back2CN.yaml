# BacktoCN
# port of HTTP
port: 7890

# port of SOCKS5
socks-port: 7891

# (HTTP and SOCKS5 in one port)
# mixed-port: 7890

# redir port for Linux and macOS
# redir-port: 7892

allow-lan: true
mode: rule
log-level: info
external-controller: 127.0.0.1:9090

proxies:

proxy-groups:
  - name: PROXY
    type: select
    use:
     - P1
     - P2
     - P3
     - P4
     - P5
     - P6     
  - name: SELECT-PROVIDER
    type: select
    proxies:
     - PROVIDER 1 - BIHAI
     - PROVIDER 2 - LAOWANG
     - PROVIDER 3 - HELLOPOLL
     - PROVIDER 4 - TOSHIKI
     - PROVIDER 5 - SSPOOL
     - PROVIDER 6 - YIUN     
  - name: AUTOMATIC
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    use:
     - P1
     - P2
     - P3
     - P4
     - P5
     - P6 
  - name: LOAD-BALANCE
    type: load-balance
    strategy: consistent-hashing #round-robin
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    use:
     - P1
     - P2
     - P3
     - P4
     - P5
     - P6
  - name: PROVIDER 1 - BIHAI
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    use:
     - P1
  - name: PROVIDER 2 - LAOWANG
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    use:
     - P2
  - name: PROVIDER 3 - HELLOPOLL
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    use:
     - P3
  - name: PROVIDER 4 - TOSHIKI
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    use:
     - P4
  - name: PROVIDER 5 - SSPOOL
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    use:
     - P5
  - name: PROVIDER 6 - YIUN
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    use:
     - P6
  - name: XIAOMI
    type: select
    proxies:
      - AUTOMATIC
      - LOAD-BALANCE
      - PROXY
      - SELECT-PROVIDER
      - GLOBAL-CONNECT
  - name: CHINA-MUSIC
    type: select
    proxies:
      - AUTOMATIC
      - LOAD-BALANCE
      - PROXY
      - SELECT-PROVIDER
      - GLOBAL-CONNECT
  - name: CHINA-IP
    type: select
    proxies: 
      - AUTOMATIC
      - LOAD-BALANCE
      - PROXY
      - SELECT-PROVIDER
      - GLOBAL-CONNECT
  - name: GLOBAL-CONNECT
    type: select
    proxies:
      - DIRECT
      - REJECT 
proxy-providers:
  P1:
    type: http
    url: "https://proxies.bihai.cf/clash/proxies?c=CN,HK"
    path: proxies.bihai.cf/provider-cn.yaml
    interval: 7200
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204
  P2:
    type: http
    url: "https://proxypool.laowang.me/clash/proxies?c=CN,HK"
    path: proxypool.laowang.me/provider-cn.yaml
    interval: 7200
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204
  P3:
    type: http
    url: "https://hellopool.herokuapp.com/clash/proxies?c=CN,HK"
    path: hellopool.herokuapp.com/provider-cn.yaml
    interval: 7200
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204
  P4:
    type: http
    url: "https://proxypool.toshiki.top/clash/proxies?c=CN,HK"
    path: proxypool.toshiki.top/provider-cn.yaml
    interval: 7200
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204
  P5:
    type: http
    url: "https://sspool.herokuapp.com/clash/proxies?c=CN,HK"
    path: sspool.herokuapp.com/provider-cn.yaml
    interval: 7200
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204
  P6:
    type: http
    url: "https://proxy.yiun.xyz/clash/proxies?c=CN,HK"
    path: proxy.yiun.xyz/provider-cn.yaml
    interval: 7200
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204
rules:
  #GENERAL RULES  
  - DOMAIN-SUFFIX,smtp,DIRECT
  - DOMAIN-KEYWORD,aria2,DIRECT
  - DOMAIN-SUFFIX,local,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
  - IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
  - IP-CIDR,127.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,100.64.0.0/10,DIRECT,no-resolve

  # XIAOMI
  - DOMAIN-KEYWORD,xiaomi,XIAOMI
  - DOMAIN-SUFFIX,mi.com,XIAOMI
  - DOMAIN-SUFFIX,xiaomi.com,XIAOMI
  - DOMAIN-SUFFIX,xiaomi.net,XIAOMI
  - DOMAIN-SUFFIX,xiaomi.cn,XIAOMI
  - DOMAIN-SUFFIX,xiaomicp.com,XIAOMI
  - DOMAIN-SUFFIX,miwifi.com,XIAOMI
  - DOMAIN-SUFFIX,iotcplatform.com,XIAOMI
  
  # CHINA-MUSIC
  - DOMAIN-SUFFIX,126.net,CHINA-MUSIC
  - DOMAIN-SUFFIX,music.163.com,CHINA-MUSIC
  - DOMAIN-SUFFIX,music.qq.com,CHINA-MUSIC
  - DOMAIN-SUFFIX,tc.qq.com,CHINA-MUSIC
  
  # Others
  - GEOIP,CN,CHINA-IP
  - MATCH,GLOBAL-CONNECT
